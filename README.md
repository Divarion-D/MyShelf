## Общая архитектура

Код представляет собой JavaScript-приложение для отображения каталога **аниме, фильмов и сериалов** с поддержкой:
- Главной страницы (`index.html`)
- Страниц категорий
- Фильтрации, пагинации, модальных окон
- Поддержки темной/светлой темы
- Параметров в URL (`?view=...&category=...`)

---

## Ключевые переменные и их назначение

| Переменная | Тип | Описание |
|-----------|-----|---------|
| `categories` | `Object` | Конфигурация категорий. Определяет, какие годы доступны и есть ли список "запланированного". |
| `homeItemsPerPage` | `Number` | Количество элементов на главной странице в каждой секции (по умолчанию `10`). |
| `categoryItemsPerPage` | `Number` | Количество элементов на одной странице в категории (по умолчанию `20`). |
| `defaultCategory` | `String` | Категория по умолчанию — `'anime'`. |
| `currentPage` | `Number` | Текущая страница пагинации (начинается с `1`). |
| `allData` | `Array` | Все загруженные элементы (просмотренные + запланированные). |
| `filteredData` | `Array` | Отфильтрованные данные (для пагинации и рендера). |

---

## Структура объекта `categories`

```js
const categories = {
    anime: { years: [2024, 2023, ...], hasPlanned: true },
    movies: { years: [2024, 2023, ...], hasPlanned: true },
    series: { years: [2024, 2023, 2022], hasPlanned: true }
};
```

### Поля:
- `years: number[]` — Годы, для которых есть JSON-файлы с просмотренными элементами.
- `hasPlanned: boolean` — Есть ли файл `planned.json` для этой категории.

> **Пример**: `data/anime/2024.json`, `data/anime/planned.json`

---

## GET-параметры (URL-параметры)

Код анализирует URL через `new URLSearchParams(window.location.search)`.

| Параметр | Пример | Описание |
|--------|-------|--------|
| `category` | `?category=movies` | Переопределяет текущую категорию. **Должен совпадать с ключом в `categories`**. |
| `view` | `?view=planned` или `?view=watched` | Определяет, что показывать: запланированное или просмотренное. |

### Примеры URL:

| URL | Результат |
|-----|---------|
| `watched.html` | Показывает **просмотренное** аниме |
| `watched.html?view=planned` | Показывает **запланированное** аниме |
| `watched.html?category=series` | Показывает **сериалы** (если `series` есть в `categories`) |
| `index.html` | Главная страница: фильмы + сериалы (без аниме) |

> **Важно**: `view=planned` работает **только** если `hasPlanned: true` в категории.

---

## Структура данных в JSON-файлах

Каждый элемент должен содержать:

```json
{
  "name": "Название",
  "img": "путь/к/обложке.jpg",
  "date": "2024-01-15",
  "series": 12,
  "time": 24,
  "movie": 0,  // 1 = фильм, 0 = сериал
  "description": "Краткое описание"
}
```

---

## Пагинация и фильтрация

| Функция | Описание |
|-------|--------|
| `renderGallery(data, type, pageType)` | Рендерит карточки |
| `headerMenu(category)` | Рендерит меню в navbar |
| `renderPagination(list)` | Создаёт пагинацию |
| `applyFilters()` | Фильтры: поиск, тип, год, сортировка |

### Фильтры (на странице категории):

| Элемент | ID | Функция |
|-------|----|-------|
| Поиск | `search-input` | По названию |
| Тип | `type-filter` | `any`, `movie`, `series` |
| Год | `year-filter` | Выпадающий список |
| Чекбоксы годов | `input[name="year"]` | Множественный выбор |
| Сортировка | `sort-filter` | `date-desc`, `name-asc` и т.д. |

---

## Фоновые изображения

```js
const backgrounds = {
    anime: ['assets/img/breadcrumb/anime/1.jpeg', ...]
};
```

- Случайно выбирается фон для `.site-breadcrumb` на основе текущей `category`.

---

## Тема (тёмная/светлая)

- Хранится в `localStorage` как `"theme": "dark"` или `"light"`
- Переключатель: `.theme-mode-control`
- Логотип меняется: `.logo-light-mode` / `.logo-dark-mode`

---

## Как добавить новую категорию

1. Добавьте в `categories`:

```js
mynewcat: { years: [2024, 2023], hasPlanned: true }
```

2. Создайте файлы:
   - `data/mynewcat/2024.json`
   - `data/mynewcat/planned.json` (если `hasPlanned: true`)

3. (Опционально) Добавьте фоны в `backgrounds.mynewcat`

4. Ваша категория будет доступна по ссылке:
`watched.html?category=mynewcat`

---

## Полезные функции

| Функция | Назначение |
|-------|----------|
| `shuffleArray(arr)` | Перемешивает массив (для главной страницы) |
| `safeAddEvent(id, event, handler)` | Безопасно добавляет обработчик |
| `initMovieCarousel(type)` | Инициализирует Owl Carousel |
| `showModal(item)` | Открывает модальное окно |

---

## Резюме: Как использовать GET-параметры

| Задача | URL |
|------|-----|
| Показать запланированное аниме | `watched.html?view=planned` |
| Показать просмотренные фильмы | `watched.html?view=watched` |
| Показать сериалы или другую категорию | `watched.html?category=series` |
| Главная страница | `index.html` |

> **Все параметры опциональны**, приоритет: **URL > файл > дефолт**

---

## Заключение

Система гибкая, модульная и легко расширяемая.  
**Ключевые моменты:**
- Управление через `categories` и JSON-файлы
- Гибкие GET-параметры
- Автоматическая пагинация и фильтрация
- Поддержка тем и каруселей

---

**Готово к использованию и масштабированию.**